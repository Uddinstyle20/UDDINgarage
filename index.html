<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SPARKY â€” Beranda</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="site-header" role="banner">
  <div class="container header-inner">
    <div class="brand">
      <span class="logo-wrap" role="img" aria-label="SPARKY logo">
        <img src="logo.jpg" srcset="logo@2x.jpg 2x" alt="SPARKY logo" class="logo" width="72" height="72" loading="lazy" decoding="async" />
      </span>
      <!-- brand title intentionally hidden for highlight logo -->
    </div>

    <nav class="site-nav" role="navigation" aria-label="Main menu">
      <a href="index.html">Beranda</a>
      <a href="about.html">Tentang Kami</a>
      <a href="direktori.html">Direktori</a>
      <a href="blogs.html">Blogs</a>
    </nav>

    <div class="header-actions">
      <button id="themeToggle" class="btn-ghost" type="button" aria-pressed="false" aria-label="Beralih mode gelap/terang">ðŸŒ—</button>
    </div>
  </div>
</header>

    <main>
        <section class="hero container">
            <div class="hero-inner">
                <h2>Selamat Datang di SPARKY</h2>
                <p>Layanan servis profesional untuk alat elektronik rumah tangga & industri.</p>
                <div class="hero-ctas">
                    <a class="btn" href="index.html#antrian">Lihat Layanan</a>
                    <a class="btn btn-outline" href="#kontak">Hubungi Kami</a>
                </div>
            </div>
        </section>

        <section id="layanan" class="container">
            <h2>Layanan Kami</h2>
            <div class="cards">
                <article class="card">
                    <h3>Servis Ringan</h3>
                    <p>Perbaikan perangkat rumah tangga: kipas, dispenser, lampu, dan lainnya.</p>
                </article>
                <article class="card">
                    <h3>Servis Berat</h3>
                    <p>Perbaikan peralatan industri & komponen dengan prosedur keselamatan lengkap.</p>
                </article>
                <article class="card">
                    <h3>Custom / Konsultasi</h3>
                    <p>Konsultasi khusus & permintaan layanan di luar daftar standar.</p>
                </article>
            </div>
        </section>

        <section id="antrian" class="container antrian-section">
            <h2>Daftar Antrian</h2>

            <div class="queue-grid">
              <!-- Form card -->
              <div class="queue-card" aria-labelledby="antrianFormTitle">
                <h3 id="antrianFormTitle" style="margin-top:0">Daftar Baru</h3>
                <form id="formAntrian" class="form-inline" aria-label="Form pendaftaran antrian">
                    <label class="sr-only" for="namaPelanggan">Nama</label>
                    <input id="namaPelanggan" name="namaPelanggan" type="text" placeholder="Nama lengkap" required />
                    <label class="sr-only" for="jenisServis">Jenis servis</label>
                    <select id="jenisServis" name="jenisServis" required>
                        <option value="">Pilih jenis servis</option>
                        <option value="Servis Ringan">Servis Ringan</option>
                        <option value="Servis Berat">Servis Berat</option>
                        <option value="Custom/Request">Custom / Request</option>
                    </select>
                    <button type="submit" class="btn">Tambah</button>
                </form>

                <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
                    <button id="deleteQueue" class="btn-outline" style="display:none">Hapus Semua (Admin)</button>
                </div>
              </div>

              <!-- List card -->
              <div class="queue-card">
                <div class="daftar-antrian">
                    <h3>Daftar Saat Ini</h3>
                    <ul id="listAntrian" class="list-reset" aria-live="polite">
                        <li class="queue-empty">Memuat antrian...</li>
                    </ul>
                </div>
              </div>
            </div>
        </section>

        <section id="rating" class="container rating-section" aria-labelledby="ratingTitle">
            <h2 id="ratingTitle">Ulasan & Kepuasan Pelanggan</h2>
            <p class="muted">Satu ulasan per nama. Nama diambil dari formulir antrian atau sesi anonim.</p>
            <div class="rating-card">
            <div class="rating-widget" id="ratingWidget" role="radiogroup" aria-label="Berikan rating layanan">
                <button class="star" data-value="1" aria-label="1 bintang" role="radio" aria-checked="false">â˜…</button>
                <button class="star" data-value="2" aria-label="2 bintang" role="radio" aria-checked="false">â˜…</button>
                <button class="star" data-value="3" aria-label="3 bintang" role="radio" aria-checked="false">â˜…</button>
                <button class="star" data-value="4" aria-label="4 bintang" role="radio" aria-checked="false">â˜…</button>
                <button class="star" data-value="5" aria-label="5 bintang" role="radio" aria-checked="false">â˜…</button>
            </div>
            <div class="rating-summary">
                <div id="ratingText" class="rating-text">Belum ada rating</div>
                <div id="ratingMeta" class="rating-meta" aria-hidden="true"></div>
            </div>
            </div>
            <div class="reviews">
            <h4>Ulasan Terbaru</h4>
            <ul id="reviewsList" class="list-reset" aria-live="polite"></ul>
            </div>

            <script>
            (function () {
                const STORAGE_KEY = 'sparky_reviews_v1';
                const widget = document.getElementById('ratingWidget');
                const stars = Array.from(widget.querySelectorAll('.star'));
                const ratingText = document.getElementById('ratingText');
                const ratingMeta = document.getElementById('ratingMeta');
                const reviewsList = document.getElementById('reviewsList');
                const nameInput = document.getElementById('namaPelanggan');
                const formAntrian = document.getElementById('formAntrian');

                // Helpers
                function loadReviews() {
                try {
                    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
                } catch (e) {
                    return [];
                }
                }
                function saveReviews(reviews) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(reviews));
                }
                function getDisplayName() {
                const raw = nameInput && nameInput.value && nameInput.value.trim();
                if (raw) return raw;
                // session anonymous id
                if (!sessionStorage.getItem('sparky_anon')) {
                    sessionStorage.setItem('sparky_anon', 'Anon-' + Date.now().toString().slice(-5));
                }
                return sessionStorage.getItem('sparky_anon');
                }
                function updateSummary(reviews) {
                if (!reviews.length) {
                    ratingText.textContent = 'Belum ada rating';
                    ratingMeta.textContent = '';
                    return;
                }
                const avg = (reviews.reduce((s, r) => s + r.rating, 0) / reviews.length);
                ratingText.textContent = 'Rating rata-rata: ' + avg.toFixed(2) + ' â˜…';
                ratingMeta.textContent = reviews.length + ' ulasan';
                }
                function renderReviews(reviews) {
                reviewsList.innerHTML = '';
                const sorted = reviews.slice().sort((a,b) => b.time - a.time);
                sorted.forEach(r => {
                    const li = document.createElement('li');
                    li.className = 'review-item';
                    li.innerHTML = '<strong>' + escapeHtml(r.name) + '</strong> â€” ' + r.rating + ' â˜…'
                    + (r.comment ? ('<div class="review-comment">' + escapeHtml(r.comment) + '</div>') : '')
                    + '<div class="review-time muted">' + new Date(r.time).toLocaleString() + '</div>';
                    reviewsList.appendChild(li);
                });
                }
                function escapeHtml(s) {
                return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
                }
                function setStarUI(value) {
                stars.forEach(st => {
                    const v = Number(st.getAttribute('data-value'));
                    const checked = v <= value;
                    st.classList.toggle('selected', checked);
                    st.setAttribute('aria-checked', String(checked));
                });
                }

                // Save rating (one per name)
                function saveRating(rating, comment) {
                const name = getDisplayName();
                const reviews = loadReviews();
                const existing = reviews.find(r => r.name === name);
                const entry = { name, rating, comment: comment || '', time: Date.now() };
                if (existing) {
                    // replace
                    const idx = reviews.indexOf(existing);
                    reviews[idx] = entry;
                } else {
                    reviews.push(entry);
                }
                saveReviews(reviews);
                updateSummary(reviews);
                renderReviews(reviews);
                ratingText.setAttribute('aria-live','polite');
                ratingText.textContent = 'Terima kasih atas rating Anda â€” ' + rating + ' â˜…';
                }

                // Star interactions
                stars.forEach(st => {
                const v = Number(st.getAttribute('data-value'));
                st.addEventListener('mouseenter', () => setStarUI(v));
                st.addEventListener('focus', () => setStarUI(v));
                st.addEventListener('mouseleave', () => {
                    // clear hover state to reflect stored or none
                    const reviews = loadReviews();
                    const name = getDisplayName();
                    const existing = reviews.find(r => r.name === name);
                    setStarUI(existing ? existing.rating : 0);
                });
                st.addEventListener('click', async () => {
                    const comment = prompt('Tambahkan komentar singkat (opsional):');
                    saveRating(v, comment);
                });
                st.addEventListener('keydown', (ev) => {
                    if (ev.key === 'Enter' || ev.key === ' ') {
                    ev.preventDefault();
                    st.click();
                    } else if (ev.key === 'ArrowLeft' || ev.key === 'ArrowDown') {
                    ev.preventDefault();
                    const prev = stars[Math.max(0, stars.indexOf(st) - 1)];
                    prev.focus();
                    } else if (ev.key === 'ArrowRight' || ev.key === 'ArrowUp') {
                    ev.preventDefault();
                    const next = stars[Math.min(stars.length - 1, stars.indexOf(st) + 1)];
                    next.focus();
                    }
                });
                });

                // When user submits antrian, keep name (so subsequent rating uses it)
                if (formAntrian) {
                formAntrian.addEventListener('submit', () => {
                    // nameInput.value already set by user; no further action required.
                    // Optionally, focus first star to encourage rating.
                    setTimeout(() => stars[4].focus(), 300);
                });
                }

                // Init
                (function init() {
                const reviews = loadReviews();
                updateSummary(reviews);
                renderReviews(reviews);
                // set UI according to current user if they already rated
                const name = getDisplayName();
                const existing = reviews.find(r => r.name === name);
                setStarUI(existing ? existing.rating : 0);
                })();
            })();
            </script>

            <style>
            /* Minimal styles for selected stars and review items */
            .rating-widget { display:inline-flex; gap:6px; }
            .rating-widget .star { background:transparent;border:0;font-size:28px;cursor:pointer;color:#bbb; }
            .rating-widget .star.selected { color:#f5b301; }
            .review-item { margin-bottom:10px; padding-bottom:6px; border-bottom:1px solid #eee; }
            .review-comment { margin-top:4px; color:#333; }
            .review-time.muted { font-size:12px; color:#666; margin-top:4px; }
            </style>
        </section>
        <section id="kontak" class="container">
            <h2>Kontak</h2>
            <p class="muted">(Informasi kontak akan ditambahkan di sini.)</p>
        </section>
        <section id="blogs" class="container">
            <h2>Blogs</h2>
            <p class="muted">(Daftar artikel/blog akan ditambahkan di sini.)</p>
        </section>

    </main>

    <footer class="site-footer">
        <div class="container">
            <small>Â© 2025 SPARKY â€” Semua hak dilindungi.</small>
        </div>
    </footer>

    <script src="script.js" defer></script>
</body>
</html>
